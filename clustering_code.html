<h2>Clustering Code</h2>
<br/>
<p>Clustering was performed in two ways: K-means and hierarchical clustering.</p>
<br/>

<h5><b><I>K-means</I></b></h5>
<p>The source code for the K-means clustering implementation consists of three main parts. Allocate 500 sampled data to a dataframe and perform scaling using the StandardScaler class provided by Python's sklearn library. The distribution of clusters and clustering results with K set from 2 to 5 is analyzed to find the optimal K. If the metric parameter of the KMeans class is not specified, Euclidean distance is used by default. Euclidean distance is one of the most commonly used distance measures and calculates the spatial distance between data points. Additionally, to select the appropriate number of clusters (K), two methods are utilized to choose the optimal K: Elbow Point and Silhouette Score.</p>

<table class="table" style="font-size: 12px;">
  <tbody>
    <tr>
      <th>ml_clustering_code.py</th>
      <td>Perform K-means-based clustering</td>
      <td><a href="https://github.com/JihoonYun/ds/blob/main/src/ml_clustering_code.py" target="_blank"><button type="button" class="btn btn-outline-warning btn-sm">Link</button></a></td>
    </tr>
    <tr>
      <th>used_cars_data_cleaned_final_ver_sampled.csv</th>
      <td>Dataset used in K-means</td>
      <td><a href="https://drive.google.com/file/d/1QTSzRdB228BOfzoC837v5bqvetd_FG-Q/view?usp=sharing" target="_blank"><button type="button" class="btn btn-outline-warning btn-sm">Link</button></a></td>
    </tr>
    <tr>
      <th colspan="3">
        <a class="btn btn-secondary btn-sm" data-toggle="collapse" href="#collapseCode001" role="button" aria-expanded="false" aria-controls="collapseExample">
        View Code</a> &nbsp;&nbsp;<h7>Click the <b>View Code</b> button to check the entire source code.</h7>
      </th>
    </tr>
    <tr>
      <th colspan="3">    
        <div class="collapse" id="collapseCode001">
            <div class="colorscripter-code" style="color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto;font-size: 11px;"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;pandas&nbsp;<span style="color:#ff3399">as</span>&nbsp;pd</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;numpy&nbsp;<span style="color:#ff3399">as</span>&nbsp;np</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;sklearn.decomposition&nbsp;<span style="color:#ff3399">import</span>&nbsp;PCA</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;sklearn.preprocessing&nbsp;<span style="color:#ff3399">import</span>&nbsp;StandardScaler</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;sklearn.cluster&nbsp;<span style="color:#ff3399">import</span>&nbsp;KMeans</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;seaborn&nbsp;<span style="color:#ff3399">as</span>&nbsp;sns</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;matplotlib.pyplot&nbsp;<span style="color:#ff3399">as</span>&nbsp;plt</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;sklearn.metrics&nbsp;<span style="color:#ff3399">import</span>&nbsp;silhouette_score,&nbsp;silhouette_samples</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;lux</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;yellowbrick.cluster&nbsp;<span style="color:#ff3399">import</span>&nbsp;KElbowVisualizer</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Set&nbsp;the&nbsp;path&nbsp;to&nbsp;the&nbsp;CSV&nbsp;file</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;file_path&nbsp;=&nbsp;'/Users/jihoonyun/CUBoulder/R/workspace/used_cars_data_cleaned_final_ver_sampled_preprocessed.csv'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">file_path&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'/Users/jihoonyun/CUBoulder/R/workspace/used_cars_data_cleaned_final_ver_sampled.csv'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Load&nbsp;the&nbsp;CSV&nbsp;file&nbsp;into&nbsp;a&nbsp;DataFrame</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">df&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;pd.read_csv(file_path)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;define&nbsp;a&nbsp;random&nbsp;state&nbsp;variable</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">R_STATE&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">7</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;numeric_columns&nbsp;=&nbsp;['horsepower',&nbsp;'highway_fuel_economy',&nbsp;'mileage',&nbsp;'wheelbase',&nbsp;'year',&nbsp;'price']</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">numeric_columns&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;[<span style="color:#ffd500">'horsepower'</span>,&nbsp;<span style="color:#ffd500">'engine_cylinders'</span>,&nbsp;<span style="color:#ffd500">'mileage'</span>,&nbsp;<span style="color:#ffd500">'year'</span>,&nbsp;<span style="color:#ffd500">'price'</span>]</div><div style="padding:0 6px; white-space:pre; line-height:130%">boolean_columns&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;[<span style="color:#ffd500">'has_accidents'</span>]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;#&nbsp;Extract&nbsp;numeric&nbsp;columns</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">numeric_df&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df[numeric_columns]</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;#&nbsp;Extract&nbsp;boolean&nbsp;columns</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">boolean_df&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df[boolean_columns]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Create&nbsp;a&nbsp;new&nbsp;DataFrame&nbsp;by&nbsp;concatenating&nbsp;numeric&nbsp;and&nbsp;boolean&nbsp;DataFrames</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;cluster_df&nbsp;=&nbsp;pd.concat([numeric_df,&nbsp;boolean_df],&nbsp;axis=1)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">cluster_df&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;numeric_df</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;#&nbsp;Convert&nbsp;boolean&nbsp;columns&nbsp;to&nbsp;numeric&nbsp;(True&nbsp;-&gt;&nbsp;1,&nbsp;False&nbsp;-&gt;&nbsp;0)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;for&nbsp;column&nbsp;in&nbsp;boolean_columns:</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cluster_df[column]&nbsp;=&nbsp;cluster_df[column].astype(int)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Define&nbsp;Max&nbsp;Cluster</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">max_clusters&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">6</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;#&nbsp;Create&nbsp;a&nbsp;scaler</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">scaler&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;StandardScaler()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Apply&nbsp;scaling&nbsp;to&nbsp;all&nbsp;columns</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">df_scaled&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;pd.DataFrame(scaler.fit_transform(cluster_df),&nbsp;columns<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>cluster_df.columns)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Print&nbsp;the&nbsp;DataFrame</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#4be6fa">print</span>(df_scaled.head())&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Print&nbsp;the&nbsp;first&nbsp;5&nbsp;rows&nbsp;of&nbsp;the&nbsp;DataFrame</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#4be6fa">print</span>(df_scaled.info())</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">silhouette_scores&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;[]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">for</span>&nbsp;k&nbsp;<span style="color:#ff3399">in</span>&nbsp;<span style="color:#4be6fa">range</span>(<span style="color:#c10aff">2</span>,&nbsp;max_clusters):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;df_scaled_copy&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df_scaled.copy()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Create&nbsp;a&nbsp;K-Means&nbsp;clustering&nbsp;model</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;kmeans&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;KMeans(n_clusters<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>k,&nbsp;random_state<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>R_STATE)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Fit&nbsp;the&nbsp;model&nbsp;to&nbsp;the&nbsp;scaled&nbsp;data</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;kmeans.fit(df_scaled_copy)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Get&nbsp;cluster&nbsp;labels&nbsp;for&nbsp;each&nbsp;data&nbsp;point</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;cluster_labels&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;kmeans.labels_</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Perform&nbsp;PCA&nbsp;for&nbsp;dimensionality&nbsp;reduction&nbsp;to&nbsp;2D</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;pca&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;PCA(n_components<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">2</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;reduced_data&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;pca.fit_transform(df_scaled_copy)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Add&nbsp;cluster&nbsp;labels&nbsp;to&nbsp;the&nbsp;reduced&nbsp;data&nbsp;DataFrame</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;reduced_df&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;pd.DataFrame(reduced_data,&nbsp;columns<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>[<span style="color:#ffd500">'PC1'</span>,&nbsp;<span style="color:#ffd500">'PC2'</span>])</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;reduced_df[<span style="color:#ffd500">'Cluster'</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;cluster_labels</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;df_scaled_copy[<span style="color:#ffd500">'Cluster'</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;cluster_labels</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Calculate&nbsp;the&nbsp;mean&nbsp;of&nbsp;each&nbsp;column&nbsp;for&nbsp;each&nbsp;cluster</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;cluster_means&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df_scaled_copy.groupby(<span style="color:#ffd500">'Cluster'</span>).mean()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">print</span>(f<span style="color:#ffd500">'K&nbsp;=&nbsp;{k}'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;pd.set_option(<span style="color:#ffd500">'display.max_columns'</span>,&nbsp;<span style="color:#4be6fa">None</span>)&nbsp;&nbsp;<span style="color:#999999">#&nbsp;No&nbsp;limit&nbsp;to&nbsp;show&nbsp;the&nbsp;maximum&nbsp;columns</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">print</span>(cluster_means)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">print</span>(cluster_means.to_html())</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Calculate&nbsp;cluster&nbsp;centers&nbsp;in&nbsp;the&nbsp;reduced&nbsp;2D&nbsp;space</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;cluster_centers_2d&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;pca.transform(kmeans.cluster_centers_)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.figure(dpi<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">300</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.figure(figsize<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>(<span style="color:#c10aff">10</span>,&nbsp;<span style="color:#c10aff">6</span>))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Plot&nbsp;the&nbsp;clustered&nbsp;data&nbsp;in&nbsp;2D&nbsp;using&nbsp;seaborn</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;sns.scatterplot(data<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>reduced_df,&nbsp;x<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'PC1'</span>,&nbsp;y<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'PC2'</span>,&nbsp;hue<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'Cluster'</span>,&nbsp;palette<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'Set1'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.scatter(cluster_centers_2d[:,&nbsp;<span style="color:#c10aff">0</span>],&nbsp;cluster_centers_2d[:,&nbsp;<span style="color:#c10aff">1</span>],&nbsp;c<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'black'</span>,&nbsp;marker<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'X'</span>,&nbsp;s<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">100</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'Cluster&nbsp;Centers'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.title(<span style="color:#ffd500">'K-Means&nbsp;Clustering&nbsp;Results&nbsp;(2D)&nbsp;with&nbsp;Cluster&nbsp;Centers'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.xlabel(<span style="color:#ffd500">'Principal&nbsp;Component&nbsp;1'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.ylabel(<span style="color:#ffd500">'Principal&nbsp;Component&nbsp;2'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.legend()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;plt.show()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;silhouette_avg&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;silhouette_score(df_scaled,&nbsp;kmeans.labels_)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;silhouette_scores.append(silhouette_avg)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#4be6fa">print</span>(silhouette_avg)</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">################################################################################</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Elbow&nbsp;Point</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">################################################################################</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Use&nbsp;the&nbsp;Elbow&nbsp;Method&nbsp;to&nbsp;find&nbsp;the&nbsp;optimal&nbsp;number&nbsp;of&nbsp;clusters</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">visualizer&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;KElbowVisualizer(KMeans(n_clusters<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">0</span>,&nbsp;random_state<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>R_STATE),&nbsp;k<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>(<span style="color:#c10aff">1</span>,&nbsp;max_clusters),&nbsp;timings<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">False</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">visualizer.fit(df_scaled)</div><div style="padding:0 6px; white-space:pre; line-height:130%">visualizer.show()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">################################################################################</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Silhouette&nbsp;Score</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">################################################################################</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;max_clusters_ss&nbsp;=&nbsp;7</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Calculate&nbsp;silhouette&nbsp;scores&nbsp;to&nbsp;find&nbsp;the&nbsp;optimal&nbsp;number&nbsp;of&nbsp;clusters</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;silhouette_scores&nbsp;=&nbsp;[]</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;for&nbsp;k&nbsp;in&nbsp;range(2,&nbsp;max_clusters):</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kmeans&nbsp;=&nbsp;KMeans(n_clusters=k,&nbsp;random_state=R_STATE).fit(df_scaled)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;silhouette_avg&nbsp;=&nbsp;silhouette_score(df_scaled,&nbsp;kmeans.labels_)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;silhouette_scores.append(silhouette_avg)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(f'cluster:&nbsp;{k}&nbsp;//&nbsp;silhouette&nbsp;index:&nbsp;{silhouette_avg}')</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Display&nbsp;the&nbsp;Silhouette&nbsp;Score&nbsp;plot</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.figure(dpi<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">300</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.figure(figsize<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>(<span style="color:#c10aff">8</span>,&nbsp;<span style="color:#c10aff">6</span>))</div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.plot(<span style="color:#4be6fa">range</span>(<span style="color:#c10aff">2</span>,&nbsp;max_clusters),&nbsp;silhouette_scores,&nbsp;marker<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'o'</span>,&nbsp;linestyle<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'-'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.xlabel(<span style="color:#ffd500">'Number&nbsp;of&nbsp;Clusters&nbsp;(K)'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.ylabel(<span style="color:#ffd500">'Silhouette&nbsp;Score'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.title(<span style="color:#ffd500">'Silhouette&nbsp;Score&nbsp;for&nbsp;Optimal&nbsp;K'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.grid(<span style="color:#4be6fa">True</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">plt.show()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">for</span>&nbsp;n_clusters&nbsp;<span style="color:#ff3399">in</span>&nbsp;<span style="color:#4be6fa">range</span>(<span style="color:#c10aff">2</span>,&nbsp;max_clusters):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Create&nbsp;K-means&nbsp;model</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kmeans&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;KMeans(n_clusters<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>n_clusters,&nbsp;random_state<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>R_STATE)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cluster_labels&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;kmeans.fit_predict(df_scaled)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Silhouette&nbsp;Score&nbsp;Calculation</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;silhouette_avg&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;silhouette_score(df_scaled,&nbsp;cluster_labels)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">print</span>(f<span style="color:#ffd500">"For&nbsp;n_clusters&nbsp;=&nbsp;{n_clusters},&nbsp;the&nbsp;average&nbsp;silhouette&nbsp;score&nbsp;is&nbsp;{silhouette_avg:.2f}"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Calculate&nbsp;the&nbsp;silhouette&nbsp;score&nbsp;for&nbsp;each&nbsp;sample</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sample_silhouette_values&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;silhouette_samples(df_scaled,&nbsp;cluster_labels)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.figure(figsize<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>(<span style="color:#c10aff">6</span>,&nbsp;<span style="color:#c10aff">4</span>))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_lower&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">10</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">for</span>&nbsp;i&nbsp;<span style="color:#ff3399">in</span>&nbsp;<span style="color:#4be6fa">range</span>(n_clusters):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ith_cluster_silhouette_values&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;sample_silhouette_values[cluster_labels&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;i]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ith_cluster_silhouette_values.sort()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_cluster_i&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;ith_cluster_silhouette_values.shape[<span style="color:#c10aff">0</span>]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_upper&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;y_lower&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">+</span>&nbsp;size_cluster_i</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;plt.cm.get_cmap(<span style="color:#ffd500">"Spectral"</span>)(float(i)&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">/</span>&nbsp;n_clusters)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.fill_betweenx(np.arange(y_lower,&nbsp;y_upper),&nbsp;<span style="color:#c10aff">0</span>,&nbsp;ith_cluster_silhouette_values,&nbsp;facecolor<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>color,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edgecolor<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>color,&nbsp;alpha<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">0.</span><span style="color:#c10aff">7</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.text(<span style="color:#0086b3"></span><span style="color:#ff3399">-</span><span style="color:#c10aff">0.</span><span style="color:#c10aff">05</span>,&nbsp;y_lower&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">+</span>&nbsp;<span style="color:#c10aff">0.</span><span style="color:#c10aff">5</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">*</span>&nbsp;size_cluster_i,&nbsp;<span style="color:#4be6fa">str</span>(i))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_lower&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;y_upper&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">+</span>&nbsp;<span style="color:#c10aff">10</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.title(<span style="color:#ffd500">"Silhouette&nbsp;plot&nbsp;for&nbsp;various&nbsp;clusters"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.xlabel(<span style="color:#ffd500">"Silhouette&nbsp;coefficient&nbsp;values"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.ylabel(<span style="color:#ffd500">"Cluster&nbsp;label"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;The&nbsp;vertical&nbsp;line&nbsp;for&nbsp;average&nbsp;silhouette&nbsp;score&nbsp;of&nbsp;all&nbsp;the&nbsp;values</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.axvline(x<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>silhouette_avg,&nbsp;color<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">"red"</span>,&nbsp;linestyle<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">"--"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plt.show()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#4f4f4ftext-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>              
        </div>
      </th>
    </tr>
  </tbody>
</table>


<h5><b><I>Hierarchical clustering</I></b></h5>
<p>First, 80 random samples are taken from the 500 sampled data obtained in the data step. Then, after scaling the data, clustering is performed using the hclust library. The similarity between each data point is calculated using the cosine similarity. When running the hclust function, the value of method is set to ward. The advantage of Ward's linkage is that it is generally helpful for data to form balanced clusters and minimize the variance between clusters. Finally, we draw a dendrogram based on the clustering results and use it to analyze the hierarchical structure.</p>

<table class="table" style="font-size: 12px;">
  <tbody>
    <tr>
      <th>ml_clustering_code_2.R</th>
      <td>Perform Hierarchical clustering-based clustering</td>
      <td><a href="https://github.com/JihoonYun/ds/blob/main/src/ml_clustering_code_2.R" target="_blank"><button type="button" class="btn btn-outline-warning btn-sm">Link</button></a></td>
    </tr>
    <tr>
      <th>used_cars_data_cleaned_final_ver_sampled.csv</th>
      <td>Dataset used in Hierarchical clustering</td>
      <td><a href="https://drive.google.com/file/d/1QTSzRdB228BOfzoC837v5bqvetd_FG-Q/view?usp=sharing" target="_blank"><button type="button" class="btn btn-outline-warning btn-sm">Link</button></a></td>
    </tr>
    <tr>
      <th colspan="3">
        <a class="btn btn-secondary btn-sm" data-toggle="collapse" href="#collapseCode002" role="button" aria-expanded="false" aria-controls="collapseExample">
        View Code</a> &nbsp;&nbsp;<h7>Click the <b>View Code</b> button to check the entire source code.</h7>
      </th>
    </tr>
    <tr>
      <th colspan="3">    
        <div class="collapse" id="collapseCode002">
            <div class="colorscripter-code" style="color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto;font-size: 11px;"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Required&nbsp;Libraries</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">library(cluster)</div><div style="padding:0 6px; white-space:pre; line-height:130%">library(proxy)</div><div style="padding:0 6px; white-space:pre; line-height:130%">library(NbClust)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Load&nbsp;CSV&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">scaled_org_data&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;read.csv(<span style="color:#ffd500">"used_cars_data_cleaned_final_ver_sampled.csv"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#scaled_data&nbsp;&lt;-&nbsp;read.csv("used_cars_data_cleaned_final_ver_sampled_preprocessed.csv")</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Set&nbsp;seed&nbsp;for&nbsp;reproducibility</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">set.seed(<span style="color:#c10aff">123</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Number&nbsp;of&nbsp;rows&nbsp;to&nbsp;sample&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">num_rows_to_sample&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;<span style="color:#c10aff">100</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Randomly&nbsp;sample&nbsp;100&nbsp;rows&nbsp;from&nbsp;the&nbsp;scaled_data&nbsp;dataframe</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">sampled_org_data&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;scaled_org_data[sample(nrow(scaled_org_data),&nbsp;num_rows_to_sample,&nbsp;replace&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;FALSE),&nbsp;]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Extract&nbsp;the&nbsp;desired&nbsp;columns&nbsp;from&nbsp;scaled_org_data</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">sampled_data&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;sampled_org_data[,&nbsp;c(<span style="color:#ffd500">'horsepower'</span>,&nbsp;<span style="color:#ffd500">'engine_cylinders'</span>,&nbsp;<span style="color:#ffd500">'mileage'</span>,&nbsp;<span style="color:#ffd500">'year'</span>,&nbsp;<span style="color:#ffd500">'price'</span>)]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Convert&nbsp;'has_accidents'&nbsp;column&nbsp;from&nbsp;strings&nbsp;to&nbsp;1&nbsp;for&nbsp;True&nbsp;and&nbsp;0&nbsp;for&nbsp;False,&nbsp;and&nbsp;then&nbsp;to&nbsp;numeric</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;sampled_data$has_accidents&nbsp;&lt;-&nbsp;as.numeric(sampled_data$has_accidents&nbsp;==&nbsp;"True")</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Scaling&nbsp;Data</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">sampled_data&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;scale(sampled_data)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Calculate&nbsp;average&nbsp;value&nbsp;for&nbsp;each&nbsp;cluster</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">cosine_distance&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;proxy::dist(<span style="color:#ff3399">as</span>.matrix(sampled_data),&nbsp;method&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">"cosine"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Perform&nbsp;hierarchical&nbsp;clustering</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">hierarchical_clustering&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;hclust(cosine_distance,&nbsp;method&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">"ward.D2"</span>)&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">########</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Create&nbsp;a&nbsp;cluster&nbsp;with&nbsp;K&nbsp;set&nbsp;to&nbsp;3</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">k&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span><span style="color:#c10aff">3</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">clusters&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;cutree(hierarchical_clustering,&nbsp;k)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Label&nbsp;settings</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#labels&nbsp;&lt;-&nbsp;round(sampled_org_data$price&nbsp;/&nbsp;1000,&nbsp;digits&nbsp;=&nbsp;2)#rownames(sampled_data)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;labels&nbsp;&lt;-&nbsp;paste(sampled_org_data$model_name,&nbsp;'/',&nbsp;sampled_org_data$year)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">unique_breaks&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;unique(c(min(sampled_org_data$price),&nbsp;quantile(sampled_org_data$price,&nbsp;c(<span style="color:#c10aff">0</span>,&nbsp;<span style="color:#c10aff">0.</span><span style="color:#c10aff">2</span>,&nbsp;<span style="color:#c10aff">0.</span><span style="color:#c10aff">8</span>,&nbsp;<span style="color:#c10aff">1</span>)),&nbsp;max(sampled_org_data$price)))</div><div style="padding:0 6px; white-space:pre; line-height:130%">labels&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;cut(</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;sampled_org_data$price,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;breaks&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;unique_breaks,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;labels&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;c(<span style="color:#ffd500">"HIGH&nbsp;PRICE"</span>,&nbsp;<span style="color:#ffd500">"MEDIUM&nbsp;PRICE"</span>,&nbsp;<span style="color:#ffd500">"LOW&nbsp;PRICE"</span>),</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;include.lowest&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;TRUE</div><div style="padding:0 6px; white-space:pre; line-height:130%">)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Draw&nbsp;a&nbsp;dendrogram&nbsp;(show&nbsp;clusters)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">plot(hierarchical_clustering,&nbsp;labels&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;labels,&nbsp;cex&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">0.</span><span style="color:#c10aff">6</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Show&nbsp;K&nbsp;clusters&nbsp;(colored)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">rect.hclust(hierarchical_clustering,&nbsp;k&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;k,&nbsp;border&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'blue'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Calculate&nbsp;average&nbsp;value&nbsp;for&nbsp;each&nbsp;cluster</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">cluster_means&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;aggregate(sampled_data,&nbsp;by&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;list(Cluster&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;clusters),&nbsp;FUN&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;mean)</div><div style="padding:0 6px; white-space:pre; line-height:130%">cluster_means</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">cluster_counts&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;table(clusters)</div><div style="padding:0 6px; white-space:pre; line-height:130%">cluster_counts</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">########</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Call&nbsp;NbClust</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">nc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&lt;</span><span style="color:#0086b3"></span><span style="color:#ff3399">-</span>&nbsp;NbClust(data&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;sampled_data,&nbsp;min.nc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">2</span>,&nbsp;max.nc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">10</span>,&nbsp;method&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">"ward.D2"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">nc$Best.nc[<span style="color:#c10aff">1</span>]</div><div style="padding:0 6px; white-space:pre; line-height:130%">table(nc$Best.nc[<span style="color:#c10aff">1</span>,])</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">########</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#4f4f4ftext-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>
        </div>
      </th>
    </tr>
    </tbody>
</table>